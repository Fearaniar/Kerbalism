// ============================================================================
// Add scrubber to all crewed parts
// ============================================================================

@PART[*]:HAS[#CrewCapacity[>0],!MODULE[KerbalSeat]]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  MODULE
  {
    name = ModuleKsmProcessController
    uiGroup = #kerbalism-habitat
    id = scrubber
    resource = _Scrubber
    title = #KERBALISM_Scrubber_title // Scrubber
    capacity = #$/CrewCapacity$
    running = true
  }
}

// ============================================================================
// Add additional life support system to crewed command parts
// ============================================================================

@PART[*]:HAS[#CrewCapacity[>2]]:HAS[@MODULE[ModuleCommand]]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  MODULE
  {
    name = ModuleKsmProcessController
    uiGroup = #kerbalism-habitat
    id = processLifeSupport1
    capacity = #$/CrewCapacity$
    @capacity *= 1.6
  }

  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = Life Support
    moduleID = processLifeSupport1
    affectDragCubes = false
    affectFARVoxels = false
  }
}

@PART[*]:NEEDS[ProfileDefault]:AFTER[KerbalismDefault]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[processLifeSupport*]],*
	{
		SUBTYPE
		{
			name = _PressureControl
			title = #KERBALISM_PressureControl_title
			descriptionSummary = #KERBALISM_PressureControl_desc
		}
		SUBTYPE
		{
			name = _WaterRecycler
			title = #KERBALISM_WaterRecycler_title
			descriptionSummary = #KERBALISM_WaterRecycler_desc
			primaryColor = EggShell
			secondaryColor = Azure
		}
		SUBTYPE
		{
			name = _MonopropFuelCell
			title = #KERBALISM_MonopropO2FuelCell_title
			descriptionSummary = #KERBALISM_MonopropO2FuelCell_desc2
			primaryColor = ResourceColorMonoPropellant
			secondaryColor = ResourceColorElectricChargePrimary
		}

    @SUBTYPE,*
    {
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          running = true
        }
      }
    }
	}
}


// ============================================================================
// Add scrubber process to EVA kerbals
// ============================================================================

@PART[kerbalEVA*]:HAS[@MODULE[ModuleTripLogger]]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  MODULE
  {
    name = ModuleKsmProcessController
    id = scrubber-nonregen
    resource = _NonRegenScrubber
    title = #KERBALISM_NonRegenScrubber_title // Non-Regen Scrubber
    capacity = 1.0
    toggle = true
    running = true
  }
}
