// Deprecated Configuration
//
// This configuration is here to retain backwards compatibility.
// After Kerbalism 3.6 (Feb. 2020), the ProcessController and Configure modules
// for habitats, command pods, chemical plant and the ISRUs was replaced by
// a newer ModuleKsmProcessController that is switched by B9PartSwitch.
//
// This configuration makes sure that existing vessels still have the part
// modules needed to function. Until we create a save game breaking release
// (or, at some point in the distant future, decide to no longer support ancient
// saves), this file needs to stay.


// ============================================================================
// ISRU chemical plants
// ============================================================================

@PART[kerbalism-chemicalplant]:NEEDS[ProfileDefault]
{
  MODULE
  {
    name = ProcessController
    resource = _WaterElectrolysis
    title = #KERBALISM_WaterElectrolysis_title//Water electrolysis
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Sabatier
    title = #KERBALISM_SabatierProcess_title//Sabatier process
    capacity = 1
    valve_i = 2 // workaround until we have a better way to deal with dump valves
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Haber
    title = #KERBALISM_HaberProcess_title//Haber process
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteIncinerator
    title = Waste incinerator
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteCompressor
    title = #KERBALISM_WasteIncinerator_title//Waste compressor
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Anthraquinone
    title = #KERBALISM_AnthraquinoneProcess_title//Anthraquinone process
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _HydrazineProduction
    title = #KERBALISM_HydrazineProduction_title//Hydrazine production
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _NitroHydrazine
    title = #KERBALISM_HydrazineProductionN2_title//Hydrazine production N2
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MRE
    title = #KERBALISM_MoltenRegolithElectrolysis_title//MRE
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _SOE
    title = #KERBALISM_SolidOxideElectrolysis_title//SOE
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _SCO
    title = #KERBALISM_SelectiveCatalyticOxidation_title//SCO
    capacity = 1
    disableInEditor = true
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = ProcessController
    title = #KERBALISM_ChemicalPlant_title//Chemical Plant
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.2
  }
}

@PART[MiniISRU,ISRU]:NEEDS[ProfileDefault]
{
  !MODULE[ModuleResourceConverter]:HAS[#ConverterName[Lf+Ox]] {}
  !MODULE[ModuleResourceConverter]:HAS[#ConverterName[LiquidFuel]] {}
  !MODULE[ModuleResourceConverter]:HAS[#ConverterName[Oxidizer]] {}
  !MODULE[ModuleResourceConverter]:HAS[#ConverterName[Monoprop]] {}
  !MODULE[ModuleResourceConverter]:HAS[#ConverterName[MonoPropellant]] {}
  !MODULE[ModuleOverheatDisplay] {}
  !MODULE[ModuleCoreHeat] {}

  MODULE
  {
    name = ProcessController
    resource = _WaterElectrolysis
    title = #KERBALISM_WaterElectrolysis_title//Water electrolysis
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Sabatier
    title = #KERBALISM_SabatierProcess_title//Sabatier process
    capacity = 1
    valve_i = 2 // workaround until we have a better way to deal with dump valves
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Haber
    title = #KERBALISM_HaberProcess_title//Haber process
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteIncinerator
    title = Waste incinerator
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteCompressor
    title = #KERBALISM_WasteIncinerator_title//Waste compressor
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _Anthraquinone
    title = #KERBALISM_AnthraquinoneProcess_title//Anthraquinone process
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _HydrazineProduction
    title = #KERBALISM_HydrazineProduction_title//Hydrazine production
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _NitroHydrazine
    title = #KERBALISM_HydrazineProductionN2_title//Hydrazine production N2
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MRE
    title = #KERBALISM_MoltenRegolithElectrolysis_title//MRE
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _SOE
    title = #KERBALISM_SolidOxideElectrolysis_title//SOE
    capacity = 1
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _SCO
    title = #KERBALISM_SelectiveCatalyticOxidation_title//SCO
    capacity = 1
    disableInEditor = true
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = ProcessController
    title = #KERBALISM_ChemicalPlant_title//Chemical Plant
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.2
  }
}


@PART[MiniISRU]:NEEDS[ProfileDefault]
{
  @MODULE[ProcessController],*
  {
    @capacity *= 36.0      //  2.0 * 18  (MiniISRU is 18 times bigger than the kerbalism-chemicalplant)
  }
}

@PART[ISRU]:NEEDS[ProfileDefault]
{
  @MODULE[ProcessController],*
  {
    @capacity *= 90.0     //  36.0 * 5 / 2  (ISRU is 5 times bigger than the MiniISRU but has double the slots)
  }

  @MODULE[Configure]:HAS[#title[Chemical?Plant]]
  {
    %slots = 2
  }
}

@PART[kerbalism-chemicalplant]:NEEDS[ProfileDefault]
{
  @MODULE[ProcessController],*
  {
    @capacity *= 2.0
  }
}

// ============================================================================
// Fuel cells
// ============================================================================

@PART[FuelCell]:NEEDS[ProfileDefault]
{
  !MODULE[ModuleResourceConverter] {}
  !RESOURCE[ElectricCharge] {}

  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = #KERBALISM_H2O2FuelCell_title//H2+O2 fuel cell
    capacity = 1
    valve_i = 1 // workaround until we have a better way to deal with dump valves
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MonopropFuelCell
    title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
    capacity = 5
    disableInEditor = true
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = ProcessController
    title = #KERBALISM_FuelCell_title//Fuel Cell
    redundancy = Power Generation
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.5
  }
}

@PART[FuelCellArray]:NEEDS[ProfileDefault]
{
  !MODULE[ModuleResourceConverter] {}
  !RESOURCE[ElectricCharge] {}

  MODULE
  {
    name = ProcessController
    resource = _FuelCell
    title = #KERBALISM_H2O2FuelCell_title//H2+O2 fuel cell
    capacity = 6
    disableInEditor = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MonopropFuelCell
    title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
    capacity = 30
    disableInEditor = true
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = ProcessController
    title = #KERBALISM_FuelCell_title//Fuel Cell
    redundancy = Power Generation
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.5
  }
}

// ============================================================================
// RTG
// ============================================================================

@PART[rtg]:NEEDS[ProfileDefault]
{
  MODULE
  {
    name = ProcessController
    resource = _RTG
    title = #KERBALISM_RTG_title//RTG
    capacity = 0.75
    running = true
    toggle = false
    disableInEditor = true
  }

  !MODULE[ModuleGenerator] {}
  !MODULE[ModuleCoreHeat] {}
}


// ============================================================================
// Add configurable Life Support System to all manned parts
// ============================================================================

@PART[*]:HAS[#CrewCapacity[>0],!MODULE[KerbalSeat]]:NEEDS[ProfileDefault]
{
  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = #KERBALISM_Scrubber_title//Scrubber
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = #KERBALISM_PressureControl_title//Pressure control
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WaterRecycler
    title = #KERBALISM_WaterRecycler_title//Water recycler
    capacity = #$/CrewCapacity$
    running = true
    valve_i = 6 // workaround until we have a better way to deal with dump valves
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteProcessor
    title = #KERBALISM_WasteProcessor_title//Waste processor
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MonopropFuelCell
    title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
    capacity = #$/CrewCapacity$
    running = false
  }

  @MODULE[ProcessController],*
  {
    @capacity *= 1.67
  }
}

// boost Mk3 Shuttle cockpit and Science Lab Nitrogen storage
@PART[mk3Cockpit_Shuttle,Large_Crewed_Lab]:NEEDS[ProfileDefault]
{
  @MODULE[Configure]:HAS[#title[Pod]]
  {
    @SETUP[Pressure?Control]
    {
    @RESOURCE[Nitrogen]
      {
        @amount *= 3
        @maxAmount *= 3
      }
    }
  }
}

// ============================================================================
// Add configurable Life Support System to Life Support Unit part
// ============================================================================
// kerbalism-lifesupportmodule phasing out after Kerbalism 3.4
@PART[kerbalism-lifesupportmodule]:NEEDS[ProfileDefault]
{
  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = #KERBALISM_Scrubber_title//Scrubber
    capacity = 3
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = #KERBALISM_PressureControl_title//Pressure control
    capacity = 3
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = #KERBALISM_AirPump_title//Air Pump
    capacity = 3
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WaterRecycler
    title = #KERBALISM_WaterRecycler_title//Water recycler
    capacity = 3
    running = true
    valve_i = 6 // workaround until we have a better way to deal with dump valves
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteProcessor
    title = #KERBALISM_WasteProcessor_title//Waste processor
    capacity = 3
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MonopropFuelCell
    title = #KERBALISM_MonopropO2FuelCell_title//Monoprop+O2 fuel cell
    capacity = 3
    running = true
  }

  @MODULE[ProcessController],*
  {
    @capacity *= 1.67
  }
}
