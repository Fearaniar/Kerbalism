// ============================================================================
// ISRU drills
// ============================================================================

@PART[MiniDrill,RadialDrill]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  !MODULE[ModuleResourceHarvester] {}
  !MODULE[ModuleOverheatDisplay] {}
  !MODULE[ModuleCoreHeat] {}

  MODULE
  {
    name = Harvester
    id = harvesterCrustal
    type = 0
    ec_rate = 1.0
  }

  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = Drill
    moduleID = harvesterCrustal
    affectDragCubes = false
    affectFARVoxels = false
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = Harvester
    title = #KERBALISM_Harvester_title//Harvester
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.2
  }
}

@PART[*]:NEEDS[ProfileDefault]:AFTER[KerbalismDefault]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[harvesterCrustal*]],*
	{
		SUBTYPE
		{
			name = Water
			title = #KERBALISM_WaterExcavation_title
			descriptionSummary = #KERBALISM_WaterExcavation_desc

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.01
          // https://www.nasa.gov/sites/default/files/atoms/files/mars_ice_drilling_assessment_v6_for_public_release.pdf shows
          // water harvesters from Ice at a rate of 50-400 L/day, as a middle ground we choose 65 L/day for the small harvester
          // which when scaled by factor 5 for the big harvester becomes 325 L/day.
          rate = 0.003 // 65 L/day / (6 hours/day * 3600 seconds/hour)
          // This is the maximum abundance on a random planet/moon
          // And the average on Duna poles, which are the only place where at the time writing higher than baseline water levels are modeled
          // And lower than what is found on Kerbin and Laythe
          abundance_rate = 0.1
        }
      }
    }

    SUBTYPE
    {
      name = Ore
      title = #KERBALISM_OreExcavation_title
      descriptionSummary = #KERBALISM_OreExcavation_desc

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.02
          rate = 0.0025
        }
      }
    }

    SUBTYPE
    {
      name = Nitrogen
      title = #KERBALISM_NitrogenExcavation_title
      descriptionSummary = #KERBALISM_NitrogenExcavation_desc

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.02
          rate = 0.0025
        }
      }
    }
  }
}

@PART[kerbalism-minipump,kerbalism-radialpump]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  !MODULE[ModuleResourceHarvester] {}
  !MODULE[ModuleOverheatDisplay] {}
  !MODULE[ModuleCoreHeat] {}
  !MODULE[ModuleAsteroidDrill] {}

  MODULE
  {
    name = Harvester
    id = harvesterOceanic
    type = 1
    ec_rate = 1.0
  }

  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = Pump
    moduleID = harvesterOceanic
    affectDragCubes = false
    affectFARVoxels = false
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = Harvester
    title = #KERBALISM_Harvester_title//Harvester
    repair = Engineer
    mtbf = 72576000
    extra_cost = 1.0
    extra_mass = 0.2
  }
}

@PART[*]:NEEDS[ProfileDefault]:AFTER[KerbalismDefault]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[harvesterOceanic*]],*
	{
		SUBTYPE
		{
			name = Water
			title = #KERBALISM_WaterExcavation_title
			descriptionSummary = #KERBALISM_WaterExcavation_desc2

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.02
          rate = 0.003
        }
      }
    }

    SUBTYPE
		{
			name = Nitrogen
			title = #KERBALISM_NitrogenExcavation_title
			descriptionSummary = #KERBALISM_NitrogenExcavation_desc2

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.02
          rate = 0.0025
        }
      }
    }

    SUBTYPE
		{
			name = Ammonia
			title = #KERBALISM_AmmoniaPump_title
			descriptionSummary = #KERBALISM_AmmoniaExtraction_desc

      MODULE
      {
        IDENTIFIER {
          name = Harvester
          id = #$../../../moduleID$
        }
        DATA {
          resource = #$../../name$
          title = #$../../title$
          min_abundance = 0.02
          rate = 0.0025
        }
      }
    }
  }
}

@PART[MiniDrill,kerbalism-minipump]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  @MODULE[Harvester],*
  {
    drill = ImpactTransform
    length = 1.08
  }
}

@PART[RadialDrill,kerbalism-radialpump]:NEEDS[ProfileDefault]:FOR[KerbalismDefault]
{
  @MODULE[Harvester],*
  {
    drill = ImpactTransform
    length = 5.42
    @rate *= 5
    @ec_rate *= 5
  }
}


// ============================================================================
// atmospheric harvester
// the atmospheric experiment part is used as an atmospheric harvester
// ============================================================================

// TODO
